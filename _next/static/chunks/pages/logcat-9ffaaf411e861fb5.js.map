{"version":3,"file":"static/chunks/pages/logcat-9ffaaf411e861fb5.js","mappings":"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","sources":["webpack://_N_E/?f808","webpack://_N_E/./src/pages/logcat.tsx"],"sourcesContent":["\n    (window.__NEXT_P = window.__NEXT_P || []).push([\n      \"/logcat\",\n      function () {\n        return require(\"private-next-pages/logcat.tsx\");\n      }\n    ]);\n    if(module.hot) {\n      module.hot.dispose(function () {\n        window.__NEXT_P.push([\"/logcat\"])\n      });\n    }\n  ","import { ICommandBarItemProps, Stack, StackItem } from \"@fluentui/react\";\nimport { makeStyles, mergeClasses, shorthands } from \"@griffel/react\";\nimport { AbortController, decodeUtf8, ReadableStream, WritableStream } from '@yume-chan/adb';\nimport { Logcat, LogMessage, LogPriority } from '@yume-chan/android-bin';\nimport { autorun, makeAutoObservable, observable, runInAction, computed, action } from \"mobx\";\nimport { observer } from \"mobx-react-lite\";\nimport { NextPage } from \"next\";\nimport Head from \"next/head\";\n\nimport { CommandBar, Grid, GridColumn, GridHeaderProps, GridRowProps } from \"../components\";\nimport { GlobalState } from \"../state\";\nimport { Icons, RouteStackProps, useStableCallback } from \"../utils\";\n\nconst LINE_HEIGHT = 32;\n\nconst useClasses = makeStyles({\n    grid: {\n        height: '100%',\n        marginLeft: '-16px',\n        marginRight: '-16px',\n    },\n    header: {\n        textAlign: 'center',\n        lineHeight: `${LINE_HEIGHT}px`,\n    },\n    row: {\n        '&:hover': {\n            backgroundColor: '#f3f2f1',\n        },\n    },\n    selected: {\n        backgroundColor: '#edebe9',\n    },\n    code: {\n        fontFamily: 'monospace',\n        textOverflow: 'ellipsis',\n        whiteSpace: 'nowrap',\n        lineHeight: LINE_HEIGHT + 'px',\n        cursor: 'default',\n        ...shorthands.overflow('hidden'),\n    },\n});\n\nexport interface Column extends GridColumn {\n    title: string;\n}\n\nexport interface LogRow extends LogMessage {\n    timeString?: string;\n    payloadString?: string;\n}\n\nconst state = makeAutoObservable({\n    logcat: undefined as Logcat | undefined,\n    running: false,\n    buffer: [] as LogRow[],\n    list: [] as LogRow[],\n    count: 0,\n    stream: undefined as ReadableStream<LogMessage> | undefined,\n    stopSignal: undefined as AbortController | undefined,\n    selectedCount: 0,\n    animationFrameId: undefined as number | undefined,\n    start() {\n        if (this.running) {\n            return;\n        }\n\n        this.running = true;\n        this.stream = this.logcat!.binary();\n        this.stopSignal = new AbortController();\n        this.stream\n            .pipeTo(\n                new WritableStream({\n                    write: (chunk) => {\n                        this.buffer.push(chunk);\n                    },\n                }),\n                { signal: this.stopSignal.signal }\n            )\n            .catch(() => { });\n        this.flush();\n    },\n    flush() {\n        if (this.buffer.length) {\n            this.list.push(...this.buffer);\n            this.buffer = [];\n        }\n        if (this.running) {\n            requestAnimationFrame(this.flush);\n        }\n    },\n    stop() {\n        this.running = false;\n        this.stopSignal!.abort();\n    },\n    clear() {\n        this.list = [];\n        this.selectedCount = 0;\n    },\n    get empty() {\n        return this.list.length === 0;\n    },\n    get commandBar(): ICommandBarItemProps[] {\n        return [\n            this.running ? {\n                key: \"stop\",\n                text: \"Stop\",\n                iconProps: { iconName: Icons.Stop },\n                onClick: () => this.stop(),\n            } : {\n                key: \"start\",\n                text: \"Start\",\n                disabled: this.logcat === undefined,\n                iconProps: { iconName: Icons.Play },\n                onClick: () => this.start(),\n            },\n            {\n                key: 'clear',\n                text: 'Clear',\n                disabled: this.empty,\n                iconProps: { iconName: Icons.Delete },\n                onClick: () => this.clear(),\n            },\n            {\n                key: 'copyAll',\n                text: 'Copy Rows',\n                disabled: this.selectedCount === 0,\n                iconProps: { iconName: Icons.Copy },\n                onClick: () => {\n\n                }\n            },\n            {\n                key: 'copyText',\n                text: 'Copy Messages',\n                disabled: this.selectedCount === 0,\n                iconProps: { iconName: Icons.Copy },\n                onClick: () => {\n\n                }\n            }\n        ];\n    },\n    get columns(): Column[] {\n        return [\n            {\n                width: 200,\n                title: 'Time',\n                CellComponent: ({ rowIndex, columnIndex, className, ...rest }) => {\n                    const item = this.list[rowIndex];\n                    if (!item.timeString) {\n                        item.timeString = new Date(item.second * 1000).toISOString();\n                    }\n\n                    const classes = useClasses();\n\n                    return (\n                        <div className={mergeClasses(classes.code, className)} {...rest}>\n                            {item.timeString}\n                        </div>\n                    );\n                }\n            },\n            {\n                width: 80,\n                title: 'PID',\n                CellComponent: ({ rowIndex, columnIndex, className, ...rest }) => {\n                    const item = this.list[rowIndex];\n\n                    const classes = useClasses();\n\n                    return (\n                        <div className={mergeClasses(classes.code, className)} {...rest}>\n                            {item.pid}\n                        </div>\n                    );\n                }\n            },\n            {\n                width: 80,\n                title: 'TID',\n                CellComponent: ({ rowIndex, columnIndex, className, ...rest }) => {\n                    const item = this.list[rowIndex];\n\n                    const classes = useClasses();\n\n                    return (\n                        <div className={mergeClasses(classes.code, className)} {...rest}>\n                            {item.tid}\n                        </div>\n                    );\n                }\n            },\n            {\n                width: 100,\n                title: 'Priority',\n                CellComponent: ({ rowIndex, columnIndex, className, ...rest }) => {\n                    const item = this.list[rowIndex];\n\n                    const classes = useClasses();\n\n                    return (\n                        <div className={mergeClasses(classes.code, className)} {...rest}>\n                            {LogPriority[item.priority]}\n                        </div>\n                    );\n                }\n            },\n            {\n                width: 300,\n                flexGrow: 1,\n                title: 'Payload',\n                CellComponent: ({ rowIndex, columnIndex, className, ...rest }) => {\n                    const item = this.list[rowIndex];\n                    if (!item.payloadString) {\n                        item.payloadString = decodeUtf8(item.payload);\n                    }\n\n                    const classes = useClasses();\n\n                    return (\n                        <div className={mergeClasses(classes.code, className)} {...rest}>\n                            {item.payloadString}\n                        </div>\n                    );\n                }\n            },\n        ];\n    },\n}, {\n    buffer: false,\n    list: observable.shallow,\n    flush: action.bound,\n});\n\nautorun(() => {\n    if (GlobalState.device) {\n        runInAction(() => {\n            state.logcat = new Logcat(GlobalState.device!);\n        });\n    } else {\n        runInAction(() => {\n            state.logcat = undefined;\n            if (state.running) {\n                state.stop();\n            }\n        });\n    }\n});\n\nconst Header = observer(function Header({\n    className,\n    columnIndex,\n    ...rest\n}: GridHeaderProps) {\n    const classes = useClasses();\n\n    return (\n        <div className={mergeClasses(className, classes.header)} {...rest}>\n            {state.columns[columnIndex].title}\n        </div>\n    );\n});\n\nconst Row = function Row({\n    className,\n    rowIndex,\n    ...rest\n}: GridRowProps) {\n    const item = state.list[rowIndex];\n    const classes = useClasses();\n\n    const handleClick = useStableCallback(() => {\n        runInAction(() => {\n        });\n    });\n\n    return (\n        <div\n            className={mergeClasses(\n                className,\n                classes.row,\n            )}\n            onClick={handleClick}\n            {...rest}\n        />\n    );\n};\n\nconst LogcatPage: NextPage = () => {\n    const classes = useClasses();\n\n    return (\n        <Stack {...RouteStackProps}>\n            <Head>\n                <title>Logcat - Android Web Toolbox</title>\n            </Head>\n\n            <CommandBar items={state.commandBar} />\n\n            <StackItem grow>\n                <Grid\n                    className={classes.grid}\n                    rowCount={state.list.length}\n                    rowHeight={LINE_HEIGHT}\n                    columns={state.columns}\n                    HeaderComponent={Header}\n                    RowComponent={Row}\n                />\n            </StackItem>\n        </Stack>\n    );\n};\n\nexport default observer(LogcatPage);\n"],"names":["window","__NEXT_P","push","useClasses","makeStyles","grid","height","marginLeft","marginRight","header","textAlign","lineHeight","row","backgroundColor","selected","code","fontFamily","textOverflow","whiteSpace","LINE_HEIGHT","cursor","shorthands","state","makeAutoObservable","logcat","undefined","running","buffer","list","count","stream","stopSignal","selectedCount","animationFrameId","start","this","binary","AbortController","pipeTo","WritableStream","write","chunk","signal","catch","flush","length","requestAnimationFrame","stop","abort","clear","empty","commandBar","key","text","iconProps","iconName","Icons","onClick","disabled","columns","width","title","CellComponent","rowIndex","className","columnIndex","rest","item","timeString","Date","second","toISOString","classes","div","mergeClasses","pid","tid","LogPriority","priority","flexGrow","payloadString","decodeUtf8","payload","observable","action","autorun","GlobalState","runInAction","Logcat","Header","observer","Row","handleClick","useStableCallback","Stack","RouteStackProps","Head","CommandBar","items","StackItem","grow","Grid","rowCount","rowHeight","HeaderComponent","RowComponent"],"sourceRoot":""}